#后端技术个人思考

##后端服务

​	互联网提供了多种多样的服务，除了`美图`,`摄影`这类主要功能在手机侧的`App`，大部分的服务，其主要处理逻辑在远程的服务器后端。

​	网购、聊天、协作办公、游戏等业务，其核心，均是对数据的处理。根据业务特点，不同业务对数据处理要求有所差异，最终也导致在架构上有所区别。

##服务接入

​	`远古时代`有telnet/ftp 等各种协议的网上服务，现在网上公开的服务大部分（游戏除外）是基于HTTP。因此服务接入主要涉及HTTP服务的接入。

1. Local DNS解析：使用http访问Web资源时，要通过DNS将域名翻译为IP，此时会涉及到DNS缓存、本地DNS解析、最近DNS节点解析。此处会涉及到`运营商`问题，经典的网通、电信就因此而来。此处会有DNS劫持问题。
2. Http DNS解析：由于DNS劫持对互联网业务的影响，演变出了基于HTTP的 httpdns 服务。可以解决本地DNS的劫持问题， 见[腾讯云DNS](https://cloud.tencent.com/product/hd) 。
3. 反向代理：外网服务完成解析后，拿到一个公网IP，发起请求。如果是资源，可能是CDN的节点响应；如果是服务，请求将通过网关(gateway)处理后，再转发到真实的处理服务器（RS）。对请求者而言，RS节点是不可见的。一般gateway 使用nginx 来做，并具备一定的负载均衡的能力。

##读服务

​	看新闻、浏览评论、查看商品详情，都是从远端服务器拉取某些信息，在App/Web 上呈现的一个过程，主要是`读服务`。

​	而从后端服务的角度来看，收到用户侧请求时，做认证、安全过滤（可以由统一网关处理），提取请求参数，从redis/kv/MySQL等存储中，或者另一些服务中，拉取相应数据，拼装响应请求包。并返回给用户。

​	读请求的主要指标有`响应延时`、`响应成功率`、`P99响应延时`，`P99响应成功率`等

​	数据可用性：对于非实时UGC更新的数据（IM消息、微博评论），可采用多副本、多地的方式容灾，当某一副本异常时，接入侧可将用户流量迁移至另一副本或另一城市 。即可满足一定的可用性。    随之而来的就是多个副本间的数据一致性问题。这里有CAP理论来阐述， 可用性与一致性之间要做一定的trade-off 。

​	多中心：为了提升读服务的成功率（包括后端故障、网络解析故障等），很多互联网商会将服务部署在多个中心，每个中心有完备的一套服务能力， 正常情况下均摊服务，当某一中心异常时，通过全局调度器（可能是改域名指向，或协议上做302，或者是Client侧逻辑下发策略）将异常流量切到另一中心。历史上也有主备的模式，但一般认为资源浪费，没有双活来的稳妥。   

​	由于流量切换，存活的节点压力一般会上升，此时会用到“故障通知” “用户告示” 的方式提示用户，并且柔性降级，将部分服务置为不可用，尽最大努力 保证核心服务的稳定性。



​	

##CDN
​	图片、视频、文章内容等静态数据，为了减少逻辑服务器压力，一般会推送到离用户最近的CDN节点，前端请求时，会直接从CDN拉取，CDN会有相应的数据过期、数据回源策略。CDN也是计算机里面拆分思想的一种体现，将频繁拉取、较少变更、可以提前部署的资源或数据提前放到靠近用户的节点，降低实际服务压力，减少用户使用延时，提升用户体验

​	CDN的引入，也导致了一些小问题。 假定目前有一个Web页面，里面引用了css/js 文件，后端有逻辑变更时，会涉及css/js 的变更。此时，由于浏览器、CDN有多层缓存，导致用户仍然拉取到旧版本的文件，因此变更不生效（对于紧急BUG修复，很致命）。因此，一般的作法是将资源文件全名添加上hash值，例如 xxx.md5.js  这样新版本的文件名与旧版本不一致，促使Client侧发起新的请求，CDN也会对应 回源拉取文件。



##写服务

##服务高可用

##缓存

​	计算机世界里面的很多问题，通过加一个中间层，就能缓解或解决。

​	cpu/mem/磁盘  访问速度、存储量有所差异。因此采用恰当的缓存机制，可以有效提高服务性能。

​	`hot key` `big key`  是缓存经常碰到的问题。  `数据淘汰`是缓存设计需要考虑的策略，一般会结合业务模式，抽象出多种淘汰策略，由业务选择使用。 常见的有`LRU` `FIFO` `多级缓存`等

例如MySQL的缓存数据，为了防止一次大表扫描导致所有缓存数据被换出， 设计了多级缓存。




##数据存储

##离线分析

##数据容灾

##数据备份



## 一个创业公司的后端设计

​	后端对用户看不见，摸不着，只有崩溃的时候才会有感知。 同样，对大部分的前端请求而言，后端只是隐藏在http url 一个逻辑概念，也不会直接所有后端产生交互。但后端又很重要，承载了所有的业务数据、用户信息、用户关系、历史行为、以及公司如何去盈利的支撑。 因此，我假定一个公司场景，来摸索一下后端要如何做才能适应业务以及业务变更。

### 场景一：电子商务

​	假定当前公司的目标是要做个`拼多多`，来分析下要做哪些事情

##杂谈
 [readline](https://en.wikipedia.org/wiki/GNU_Readline)